# 钥匙和宝箱路径规划功能说明

## 修改概述

已成功将钥匙和宝箱添加到目标访问序列中，现在路径规划系统可以处理以下目标类型：

### 支持的目标类型

1. **普通食物** (type >= 1): 分值 1-5 分
2. **成长食物** (type = -1): 使蛇身增长
3. **钥匙** (type = -3): 打开宝箱的必需道具
4. **宝箱** (type = -5): 高价值目标，需要钥匙

### 核心修改

#### 1. Route 结构体注释更新

```cpp
vector<Point> seq; // 目标访问序列（包含食物、成长食物、钥匙、宝箱等所有有价值的目标）
```

#### 2. 竞争分析扩展

在 `analyze_competition()` 函数中：

- **之前**: 只分析食物和成长食物的竞争
- **现在**: 分析所有有价值目标的竞争，包括钥匙和宝箱

```cpp
// 扩展竞争分析：包含食物、成长食物、钥匙、宝箱
// 跳过陷阱(-2)，因为陷阱是有害的，不需要竞争分析
if (item.type == -2) // 只跳过陷阱
    continue;

// 对于宝箱，只有当我们有钥匙时才进行竞争分析
if (item.type == -5 && !me.has_key)
    continue;
```

#### 3. 智能钥匙-宝箱策略

代码中已实现复杂的钥匙-宝箱处理逻辑：

**钥匙策略**:

- 如果已有钥匙，跳过其他钥匙
- 评估钥匙价值时考虑附近宝箱
- 计算钥匙到宝箱的总距离和价值密度

**宝箱策略**:

- 没有钥匙时跳过宝箱（避免死亡）
- 有钥匙时给予宝箱 1.5 倍优先级加成

### 技术细节

#### 常量规范化

修复了所有硬编码的无穷大值：

```cpp
static constexpr int INF_DIST = 1000000000; // BFS算法中的无穷大距离常量
```

#### 路径构建算法

`build_route_greedy()` 函数现在能正确处理包含钥匙和宝箱的路径序列。

### 预期行为

1. **无钥匙场景**: AI 会优先寻找钥匙，特别是附近有高价值宝箱的钥匙
2. **有钥匙场景**: AI 会积极寻找宝箱，宝箱获得额外的优先级加成
3. **竞争场景**: 对钥匙和宝箱的争夺也会被纳入竞争分析

### 示例场景

```
场景1: 地图上有钥匙和宝箱
- AI没有钥匙 → 优先拿钥匙，然后去宝箱
- AI已有钥匙 → 直接优先去宝箱

场景2: 多个敌人争夺钥匙
- 竞争分析会计算到钥匙的距离优势
- 考虑护盾、长度、分数等平局决胜因素

场景3: 钥匙周围有多个宝箱
- 钥匙价值会根据附近宝箱的价值密度动态调整
- 优先选择能开启高价值宝箱的钥匙
```

## 总结

修改后的 AI 现在具备了完整的钥匙-宝箱策略处理能力，能够：

- 智能地规划钥匙 → 宝箱的路径序列
- 在竞争环境中合理评估钥匙和宝箱的价值
- 根据持有状态动态调整策略优先级

这些改进使 AI 在涉及钥匙和宝箱的游戏场景中更加智能和高效。
